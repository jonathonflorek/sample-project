#! /bin/sh
# The intended entrypoint of a docker-compose file
# running the devcontainer for development purposes
set -e

echo "Starting developer daemon"

# TODO: set some kind of warning to user that their environment is insecure based on the value of CONNECTION_TOKEN
# maybe use the CLI prompt as part of that

echo "Setting root password to CONNECTION_TOKEN"
echo "root:$CONNECTION_TOKEN" | chpasswd

echo "applying SESSION_ environment variables to /etc/profile.d/"
SESSION_PREFIX="SESSION_"
env | grep $SESSION_PREFIX | sed "s|^$SESSION_PREFIX|export |" > /etc/profile.d/session-environment.sh

echo "Starting Development Services"
supervisord -n -c /etc/supervisord.conf
